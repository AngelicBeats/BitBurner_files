import { rooting } from "util.js";
/** @param {NS} ns */
export async function main(ns) {
  let tget = ns.args[0];// name of target Server
  let maxRam = ns.getServerMaxRam(tget);
  /*let hostMaxRam = ns.getServerMaxRam('home');
  let hostAvalRam = ns.getServerUsedRam('home');*/
  let maxMoney = ns.getServerMaxMoney(tget);
  let tRamUse = Math.ceil(maxRam * .2);// calculate to use 20% of max ram target machine rounded down
  let tThread = 1;// @param: args[1] == [Thread count?: number]
  let sHack = ns.getServerRequiredHackingLevel(tget);// server hack lvl requirement
  let pHack = ns.getHackingLevel();//@return current player Hack lvl
  let rooted = ns.hasRootAccess(tget);

  //allows for modifying the number of threads on host machine for script
  if (ns.args[1] != null) { tThread = Math.round(Number(ns.args[1])); }

  await rooting(ns, tget, ns.getServerNumPortsRequired(tget));

  if ((rooted == true) && (sHack <= pHack)) {
    //Transfer files only to servers with available ram
    if (ns.getHostname() != tget && maxRam > 0) {
      ns.run('transfer.js', 1, tget);
      await ns.sleep(1000);
      if( maxMoney >0){
        ns.exec('sap.js', tget, { threads: tRamUse }, tget);
        ns.exec('reap.js', tget, { threads: tRamUse }, tget);
      }
    }
  }
}